---
title: linux下打造自己的影音平台-外网访问
date: 2020-02-27 09:30:44
categories: server
tags: linux
---

### 外网ip

  随着办理宽带用户的增加，公网IP使用分配也已逐渐告罄，运营商没有足够的公网IPV4地址分配给用户，所以只能偷偷的将公网IP换为内网IP分给多个用户使用，可以通过光猫或者路由器看看你的ip，必须和[ip138](http://www.ip138.com/)一致，否则，恭喜你，中奖了，先找运营商解决公网ip的问题吧。

  有一些光猫默认是路由模式，路由模式下，外网ip分配给了光猫，路由器拿到的也是内网ip，这样端口转发就需要在光猫上进行了，光猫性能较弱，建议将光猫改成桥接模式，只做光电信号转换，由路由器来进行拨号上网：

  ![](/images/nas/ppoe.png)

### DDNS

  宽带营运商大多只提供动态的IP地址，DDNS可以捕获用户每次变化的IP地址，然后将其与域名相对应，这样才能够稳定的外网访问，否则如果通过ip访问，一旦ip发生变化，外网就无法访问了。

  关于DDNS选择：
    - 花生壳：带宽限制，而且貌似收费了
    - 阿里云DDNS： 强烈推荐
    - 腾讯云DDNS：推荐，证书验证不如阿里云方便

  我这里使用的是阿里云DDNS：
    - shell：[aliddns-v2安装教程](https://blog.ilemonrain.com/linux/aliddns-v2.html) 
    - python：[利用python实现修改阿里云DNS值解析](https://www.jianshu.com/p/cdf7a36f0339)

### 端口转发

  通常情况下，外网ip是属于路由器的，这时候你需要一个具备端口转发功能的路由器，将外网端口转发到你的服务器上，比如：你的服务器ip是192.168.1.112，外网通过域名xxx.xxx.com访问到路由器，然后路由器需要将TCP/UDP转发到你的服务器上，才能够实现服务器的外网访问和控制

  ![](/images/nas/port-proxy.png)

### 静态内网ip

  路由器上做了端口转发，那么就需要保证服务器的ip也不能够随便更改，否则也不能保证链路通，可以通过自己设定服务器地址，或者路由器上通过mac地址绑定来固定服务器的ip

  ![](/images/nas/bind-mac-static-ip.png)